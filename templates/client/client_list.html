{% extends 'base.html' %}

{% block title %}Client List{% endblock %}

{% block content %}
<div class="container mx-auto mt-8 px-4 sm:px-6 lg:px-8">
    <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">Onboarded Clients</h1>

    <!-- Search Form -->
    <form method="GET" action="{% url 'client_list' %}" class="mb-8 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
        <div class="flex items-center space-x-2 w-full sm:w-auto">
            <input
                type="text"
                name="search"
                placeholder="Search clients..."
                class="flex-grow px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring focus:ring-blue-300"
                value="{{ request.GET.search }}"
                onkeydown="if(event.key === 'Enter'){this.form.submit();}"
            />
        </div>
    </form>

    <!-- Master-Detail Layout -->
    <div class="flex flex-col md:flex-row gap-8">
        <!-- Left Card: Client List -->
        <div class="w-full md:w-1/3 bg-white rounded-xl shadow-md p-6 overflow-auto">
            <h2 class="text-2xl font-semibold mb-4 text-gray-800">Client List</h2>
            <ul class="space-y-2">
                {% for client in clients %}
                    <li>
                        <a href="{% url 'client_list' %}?selected={{ client.pk }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
                           class="block px-4 py-2 rounded-lg hover:bg-blue-100 transition-colors {% if selected_client and selected_client.pk == client.pk %}bg-blue-200{% endif %}">
                            {{ client.business_name }}
                        </a>
                    </li>
                {% empty %}
                    <li class="text-gray-500">No clients found.</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Right Card: Client Details -->
        <div class="w-full md:w-2/3 bg-white rounded-xl shadow-md p-6 overflow-auto">
            {% if selected_client %}
                <h2 class="text-2xl font-semibold mb-4 text-gray-800">Client Details</h2>
                
                <!-- Edit Button -->
                <div class="flex justify-end mb-4">
                    <a href="{% url 'client_update' selected_client.pk %}" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow">
                        Edit
                    </a>
                </div>

                <!-- Client Information in Two Columns -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <!-- Left Column -->
                    <div class="space-y-4">
                        <!-- Basic Information -->
                        <div>
                            <h3 class="text-xl font-medium text-gray-700 mb-2">Basic Information</h3>
                            <p><strong>Business Name:</strong> {{ selected_client.business_name }}</p>
                            <p><strong>Business Description:</strong> {{ selected_client.business_description }}</p>
                            <p><strong>Website URL:</strong> <a href="{{ selected_client.website_url }}" target="_blank" class="text-blue-500 hover:underline">{{ selected_client.website_url }}</a></p>
                            <p><strong>Contact Person:</strong> {{ selected_client.contact_person }}</p>
                            <p><strong>Email:</strong> <a href="mailto:{{ selected_client.email }}" class="text-blue-500 hover:underline">{{ selected_client.email }}</a></p>
                            <p><strong>Phone Number:</strong> <a href="tel:{{ selected_client.phone_number }}" class="text-blue-500 hover:underline">{{ selected_client.phone_number }}</a></p>
                        </div>

                        <!-- Project Details -->
                        <div>
                            <h3 class="text-xl font-medium text-gray-700 mb-2">Project Details</h3>
                            <p><strong>Business Goals:</strong> {{ selected_client.business_goals }}</p>
                            <p><strong>Target Keywords:</strong> {{ selected_client.target_keywords }}</p>
                            <p><strong>CMS Type:</strong> {{ selected_client.cms_type }}</p>
                            <p><strong>Start Date:</strong> {{ selected_client.start_date|date:"M d, Y" }}</p>
                            <p><strong>End Date:</strong> {{ selected_client.end_date|date:"M d, Y" }}</p>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-4">
                        <!-- Tool Logins -->
                        <div>
                            <h3 class="text-xl font-medium text-gray-700 mb-2">Tool Logins</h3>
                            <p><strong>G4A Login Details:</strong> {{ selected_client.g4a_login }}</p>
                            <p><strong>Google Search Console Login Details:</strong> {{ selected_client.google_search_console_login }}</p>
                            <p><strong>Tag Manager Login Details:</strong> {{ selected_client.tag_manager_login }}</p>
                            <p><strong>Website Login Details:</strong> {{ selected_client.website_login }}</p>
                        </div>

                        <!-- Competitors -->
                        <div>
                            <h3 class="text-xl font-medium text-gray-700 mb-2">Competitors</h3>
                            {% if selected_client.competitor_urls_list %}
                                <ul class="list-disc pl-5">
                                    {% for url in selected_client.competitor_urls_list %}
                                        <li>
                                            <a href="{{ url }}" target="_blank" class="text-blue-500 hover:underline">{{ url }}</a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p>N/A</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="text-center text-gray-500">
                    <p>Select a client from the list to view details.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- JavaScript for Optional Enhancements (e.g., Highlight Selected Client) -->
<script>
    // Optional: Scroll the selected client into view
    document.addEventListener('DOMContentLoaded', function () {
        const selectedClientId = "{{ selected_client.pk }}" || null;
        if (selectedClientId) {
            const selectedLink = document.querySelector(`a[href*="selected=${selectedClientId}"]`);
            if (selectedLink) {
                selectedLink.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    });
</script>
{% endblock %}
