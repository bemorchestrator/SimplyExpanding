<!-- employees/templates/employees/profile.html -->

{% extends 'base.html' %}

{% block title %}
Employee Profile - Simply Expanding
{% endblock %}

{% load static %}

{% block breadcrumb %}
    <li><a href="{% url 'employees:employee_profile' %}" class="text-blue-500 hover:underline">Dashboard</a></li>
    <li>/</li>
    <li>Profile</li>
{% endblock %}

{% block content %}
<!-- Profile and Information Section -->
<div class="flex flex-col md:flex-row md:space-x-6">

    <!-- Column 1: Profile Card -->
    <div class="w-full md:w-1/3">
        <div class="bg-blue-500 text-white p-6 rounded-lg shadow-lg">
            <!-- Profile Image and Name -->
            <div class="flex items-center mb-6">
                <img class="rounded-full w-24 h-24 mr-4 object-cover" 
                     src="{% if employee.profile_picture %}{{ employee.profile_picture.url }}{% else %}{% static 'profile_pictures/default_profile.png' %}{% endif %}" 
                     alt="{{ employee.first_name }} {{ employee.last_name }}">
                <div>
                    <h2 class="text-2xl font-bold">{{ employee.first_name }} {{ employee.last_name }}</h2>
                    <p class="text-white">{{ employee.email }}</p>
                </div>
            </div>

            <!-- Employee Details in Two Columns -->
            <div class="grid grid-cols-2 gap-4">
                <p><strong>Username:</strong> {{ user.username }}</p>
                <p><strong>Email:</strong> <a href="mailto:{{ employee.email }}" class="text-white">{{ employee.email }}</a></p>

                <p><strong>First Name:</strong> {{ employee.first_name }}</p>
                <p><strong>Last Name:</strong> {{ employee.last_name }}</p>

                <p><strong>Middle Name:</strong> {{ employee.middle_name }}</p>
                <p><strong>Phone Number:</strong> {{ employee.phone_number }}</p>

                <p><strong>Address:</strong> {{ employee.address }}</p>
                <p><strong>City:</strong> {{ employee.city }}</p>

                <p><strong>Country:</strong> {{ employee.country }}</p>
                <p><strong>Occupation:</strong> {{ employee.occupation }}</p>

                <p><strong>Per Day Rate:</strong> Php {{ employee.per_day_rate }}</p>
                <p><strong>Scheduled Start Time:</strong> {{ employee.scheduled_start_time }}</p>

                <p><strong>Sex:</strong> {{ employee.sex }}</p>
                <p><strong>Date of Birth:</strong> {{ employee.birth_date|date:"M d, Y" }}</p>

                <p><strong>Date Joined:</strong> {{ employee.date_joined|date:"M d, Y" }}</p>
                <p><strong>Lateness Rules:</strong> 
                    {% for rule in employee.lateness_rules.all %}
                        <span>{{ rule.name }}</span>{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
            </div>
        </div>
    </div>

    <!-- Column 2: Cards and Attendance Table -->
    <div class="flex-1 space-y-6 mt-6 md:mt-0">
        <!-- Row with Total Attendance Card and Total Income This Month Card Side by Side -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Total Attendance Card -->
            <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                <h3 class="text-4xl font-bold text-blue-900">{{ total_attendance }}</h3>
                <p class="text-gray-700">Total Days Present</p>
            </div>

            <!-- Total Income This Month Card -->
            <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                <h3 class="text-4xl font-bold text-blue-900">Php {{ total_income_month }}</h3>
                <p class="text-gray-700">Income This Month</p>
            </div>
        </div>

        <!-- Row with Absent Days Card and 2FA Card Side by Side -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Absent Days Card -->
            <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                <h3 class="text-4xl font-bold text-blue-900">{{ absent_days }}</h3>
                <p class="text-gray-700">Total Absent Days</p>
            </div>

            <!-- 2FA Status and Actions -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h3 class="text-xl font-bold text-blue-900 mb-4">Two-Factor Authentication</h3>
                {% if employee.totp_secret %}
                    <p class="text-green-600 mb-4">Two-Factor Authentication is <strong>enabled</strong>.</p>
                    <a href="{% url 'employees:disable_2fa' %}" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Disable Two-Factor Authentication</a>
                {% else %}
                    <p class="text-gray-700 mb-4">Two-Factor Authentication is <strong>not enabled</strong>.</p>
                    <a href="{% url 'home:enable_2fa' %}" class="bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600">Enable Two-Factor Authentication</a>
                {% endif %}
            </div>
        </div>

        <!-- Attendance Log -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="flex justify-between mb-4">
                <h3 class="text-xl font-bold text-blue-900">Attendance Log</h3>
            </div>
            <table class="w-full table-auto text-left">
                <thead class="bg-blue-100">
                    <tr>
                        <th class="px-4 py-2">Date</th>
                        <th class="px-4 py-2">Time In</th>
                        <th class="px-4 py-2">Time Out</th>
                        <th class="px-4 py-2">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in attendance_logs %}
                    <tr class="bg-white border-b">
                        <td class="px-4 py-2">{{ log.clock_in_time|date:"M d, Y" }}</td>
                        <td class="px-4 py-2">{{ log.clock_in_time|time:"H:i" }}</td>
                        <td class="px-4 py-2">{{ log.clock_out_time|time:"H:i" }}</td>
                        <td class="px-4 py-2">
                            {% if log.is_late %}
                                <span class="text-red-500">Late</span>
                            {% else %}
                                <span class="text-green-500">On Time</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center py-4 text-gray-500">No attendance records found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}